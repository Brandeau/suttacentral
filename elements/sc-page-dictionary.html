<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">

<link rel="import" href="../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../bower_components/paper-spinner/paper-spinner-lite.html">
<dom-module id="sc-page-dictionary">
<template>
<style is="custom-style">
.divisioncontent, .related_terms {
  @apply(--sc-sans-font);
  padding: 72px 0;
}

main {
    max-width:720px;
    margin:0 auto;
}
.results-head{
    display: flex;
    justify-content:  space-between ;
    padding: 0 16px;
    color: var(--secondary-text-color);
}
h1{
    @apply(--paper-font-display1);
    display: inline-block;
    margin: 0;
}

.result-term{
    font-weight: bold;
    color: var(--sc-green-600);
    @apply(--sc-serif-font);
}

a {
    text-decoration: none;
    color: initial;
}
.map {
  height: 350px;
  margin-bottom: 20px;
}
.map iframe {
  height: 350px;
  width: 100%;
}
.termsbutton {
 float: right;
}
iron-icon {
  width: 16px;
  height: 16px;
}
    .related_terms {
        float: left;
        text-align: left;
        margin: 0 1em 48px;
    }
    
    ul {
        margin: 0;
        display: block;
        list-style: none;
    }
    
    .related_terms h3{
        color: var(--sc-green-600);
        margin:1em 0 0;
        font-size: 1em;
        font-weight: bold;
    }
.entries {
  padding: 0 16px;
}
.source {
    float: right;
    margin-right: 1em;
    padding: .2em 0 0 0;
    color: var(--secondary-text-color);
}
.case {
    color: var(--secondary-text-color);
    display: block;
    font-feature-settings: "smcp" 1;
    letter-spacing: .03em;
    font-size: .8rem;
}
h4 {
  font-weight: bold;
  text-transform: lowercase;
}
paper-spinner-lite {
    --paper-spinner-color: var(--sc-gold-500);
    left: 50%;
    top: 50px;
}
</style>

<iron-ajax auto url="../data/dictionaries/cped.json" handle-as="json" loading="{{loadingResults}}" last-response="{{cpedResult}}"></iron-ajax>
<iron-ajax auto url="../data/dictionaries/ncped.json" handle-as="json" loading="{{loadingResults}}" last-response="{{ncpedResult}}"></iron-ajax>
<iron-ajax auto url="../data/dictionaries/dppn.json" handle-as="json" loading="{{loadingResults}}" last-response="{{dppnResult}}"></iron-ajax>
<iron-ajax auto url="../data/dictionaries/pts.json" handle-as="json" loading="{{loadingResults}}" last-response="{{ptsResult}}"></iron-ajax>
<iron-ajax auto url="../data/dictionaries/related.json" handle-as="json" loading="{{loadingResults}}" last-response="{{relatedItems}}"></iron-ajax>

    <div class="loadingIndicator">
      <paper-spinner-lite active="{{loadingResults}}"></paper-spinner-lite>
    </div>

<div class="divisioncontent">
    <main>
        <div class="results-head">
                    <h1><span class="result-description">Definitions for</span> <span class="result-term">{{dictionaryItem}}</span> </h1>
                    <span class="termsbutton">Related Terms <iron-icon icon="arrow-forward"></iron-icon><paper-icon-button icon="menu" onclick="drawer.toggle()"></paper-icon-button></span>
        </div>

        <div class="entries">
                <template is="dom-if" if="{{ncpedItem}}">
                        <div class="book_entry">
                                <div class="source">New Concise Pali English Dictionary</div>
                                <h4>[[dictionaryItem]]</h4>
                                <p class="case">[[ncpedItem.case]]</p>
                                <div class="ncped_entry" inner-h-t-m-l="[[ncpedItem.text]]"></div>
                        </div>
                </template>        
                <template is="dom-if" if="{{cpedItem}}">
                        <div class="book_entry">
                                <div class="source">Concise Pali English Dictionary</div>
                                <h4>[[dictionaryItem]]</h4>
                                <p class="case">[[cpedItem.case]]</p>
                                <p class="cped_entry">[[cpedItem.text]]</p>
                        </div>
                </template>

                <template is="dom-repeat" items="{{_checkDictEntry(dppnResult,dictionaryItem)}}">
                        <div class="book_entry">
                                <div class="source">Pali Proper Names</div>
                                <h4>[[dictionaryItem]]</h4>
                                <template is="dom-if" if="[[item.map]]">
                                    <div class="map">
                                         <iframe src="https://www.google.com/maps/d/embed?mid=z1fKgOqM_IYc.k-W6AbJIxLu8&z=13&ll=[[item.map]]"></iframe>
                                    </div>
                                </template>
                                <div class="dppn_entry" inner-h-t-m-l="[[item.text]]"></div>
                        </div>
                </template>

                <template is="dom-repeat" items="{{_checkDictEntry(ptsResult,dictionaryItem)}}">
                        <div class="book_entry">
                                <div class="source">PTS Pali English Dictionary</div>
                                <h4>[[dictionaryItem]]</h4>
                                <p class="case">[[item.case]]</p>
                                <div class="pts_entry" inner-h-t-m-l="[[item.text]]"></div>
                        </div>
                </template>
        </div> 

        <app-drawer id="drawer" align="right" swipe-open>
                <div class="related_terms">
                        <h3>Adjacent Terms</h3>
                        <ul class="near_terms">
                            <template is="dom-repeat" items="{{relatedItems.adjacent}}">
                                <li><a href="/define?term=[[item.word]]">[[item.word]]</a> <template is="dom-if" if="[[item.trans]]"><em>([[item.trans]])</em></template></li>
                            </template>
                        </ul>
                        <h3>Similar Spelling</h3>
                        <ul class="fuzzy_terms">
                            <template is="dom-repeat" items="{{relatedItems.similar}}">
                                <li><a href="/define?term=[[item.word]]">[[item.word]]</a> <template is="dom-if" if="[[item.trans]]"><em>([[item.trans]])</em></template></li>
                            </template>
                        </ul>
                </div>
        </app-drawer>
    </main>
</div>
</template>
<script>
    Polymer({
      is: 'sc-page-dictionary',
      properties: {
        dictionaryItem: {
            type: String,
            notify: true
        },
        cpedResult: Object,
        ncpedResult: Object,
        inputLanguage: String,
        cpedItem: {
          type: String,
          computed: '_checkCpedEntry(cpedResult, dictionaryItem)'
        },
        ncpedItem: {
          type: String,
          computed: '_checkCpedEntry(ncpedResult, dictionaryItem)'
        }
      },
      _checkCpedEntry: function(dictResult, dictionaryItem) {
        return dictResult[dictionaryItem.toLowerCase()];
      },
      _checkDictEntry: function(dictResult, dictionaryItem) {
        resultsArray = [];
        for (var i=0; i < dictResult.length; i++) {
          if (dictResult[i].term.toLowerCase() === dictionaryItem.toLowerCase()) {
              resultsArray.push(dictResult[i]);
          }
        }
        return resultsArray;
      }
    });
</script>
</dom-module>
