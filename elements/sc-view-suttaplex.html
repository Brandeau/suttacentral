<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/paper-styles/paper-styles.html">
<link rel="import" href="sc-toolbar.html">
<link rel="import" href="sc-suttaplex.html">
<link rel="import" href="addons/sc-node.html">
<dom-module id="sc-view-suttaplex" attributes="divisiontitle">
<style is="custom-style">
.divisioncontent {
  color: var(--primary-text-color);
  padding: 24px 0;
}

main {
  margin: 0 auto;
  max-width: 720px;
}

.suttalist {
  margin: 0 auto;
  max-width: 720px;
  transition: margin-top 0.3s, margin-bottom 0.3s;
}
.title {
  margin-left: 64px;
}
.suttalist.expandeditem {
  @apply(--shadow-elevation-8dp);
  margin-top:20px;
  margin-bottom: 20px;
}
.node {
    padding: 16px 16px 0;
    color: var(--secondary-text-color);
}
.vagganode{
    padding: 24px 16px 16px;
    color: var(--secondary-text-color);
}
.vagganode.firstvagga, .node+.vagganode {
  padding-top: 0;
}
</style>
<template>
<iron-ajax
      auto
      url="[[_computeURL(category)]]"
      handle-as="json"
      last-response="{{suttaList}}"></iron-ajax>

<div class="divisioncontent">
  <main>
    <section class="node">
        <sc-node input-title="{{languageData.name}}" input-text="{{languageData.description}}" style-header="node-top-heading"></sc-node>
    </section>

    <template is="dom-repeat" items="{{suttaList.vaggas}}" as="vagga">
      <template is="dom-if" if="{{_selectVagga(vagga,vaggaNumber)}}">
            <section class$="vagganode {{_checkFirstVagga(vagga,vaggaNumber)}}">
              <sc-node input-title="{{_computeVagganame(vagga,inputLanguage)}}" input-text="{{_computeVaggadescription(vagga,inputLanguage)}}" style-header="node-secondary-heading"></sc-node>
            </section>

            <template is="dom-repeat" items="{{vagga.suttas}}" as="item">
              <div class="suttalist" id$="{{item}}">
                <sc-suttaplex input-url="{{item}}" input-language="{{inputLanguage}}"></sc-suttaplex>
              </div>
            </template>
        </template>
    </template>

  </main>
</div>
</template>
<script>
    Polymer({
      is: 'sc-view-suttaplex',
      properties: {
        inputLanguage: String,
        suttaList: Object,
        languageData: {
          type: Object,
          computed: '_computeLanguage(suttaList,inputLanguage)'
        },
        vaggaNumber: {
          type: String,
          value: ""
        }
      },
      observers: [
        'infoToParent(suttaList,inputLanguage)'
      ],
      ready: function() {
        this.addEventListener('toggleParallelNote', this.elevateBox);
      },
      elevateBox: function(event) {
        var sutta = document.getElementById(event.detail.url);
        return (event.detail.open === "icons:expand-more") ? sutta.classList.add('expandeditem') : sutta.classList.remove('expandeditem');
      },
      _computeURL: function(category) {
        return `../../data/list/${category}.json`;
      },
      _selectVagga: function(vagga,vaggaNumber) {
        return (vaggaNumber == undefined || vaggaNumber == "" || vaggaNumber == vagga.vagganr) ? true : false;
      },
      _checkFirstVagga: function(vagga,vaggaNumber) {
        return vaggaNumber ? ((vaggaNumber == vagga.vagganr) ? "firstvagga" : "") : "";
      },
      _computeLanguage: function(suttaList,inputLanguage) {
        return suttaList ? suttaList[inputLanguage] : "";
      },
      _computeVagganame: function(vagga,inputLanguage) {
        return vagga[inputLanguage].vagganame;
      },
      _computeVaggadescription: function(vagga,inputLanguage) {
        return vagga[inputLanguage].description;
      },
      infoToParent: function(suttaList,inputLanguage) {
        if (suttaList) {
        this.fire('eventFromSuttaplexPage',{divisiontitle:this._computeLanguage(suttaList,inputLanguage)['name']+"â€”"+suttaList['namepi']});
        }
      }
    });

</script>
</dom-module>

