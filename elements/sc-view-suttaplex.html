<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/paper-styles/paper-styles.html">
<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="sc-toolbar.html">
<link rel="import" href="sc-suttaplex.html">
<link rel="import" href="addons/sc-node.html">

<dom-module id="sc-view-suttaplex" attributes="togdraw">
<style is="custom-style">
paper-scroll-header-panel {
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      height: 100%;
      --paper-scroll-header-panel-container: {
        background-color: var(--paper-blue-grey-50);
      };
}
paper-toolbar {
   background-color: var(--paper-deep-orange-900);
  @apply(--shadow-elevation-8dp);
}
.sutta {
  text-transform: capitalize;
}

@media (max-width: 600px) {
    h1 {
      font-size: 2em;
      padding-top: 0.2em;
    };
    .subtitle {
      font-size: 1em;
    };
    .paper-header {
      height: 11em;
    };
}
paper-icon-button {
  color: white;
}
.divisioncontent {
  color: var(--primary-text-color);
  padding: 24px 0;
}

main {
  margin: 0 auto;
  max-width: 720px;
}

.suttalist {
  margin: 0 auto;
  max-width: 720px;
  transition: margin-top 0.3s, margin-bottom 0.3s;
}

.suttalist.expandeditem {
  @apply(--shadow-elevation-8dp);
  margin-top:20px;
  margin-bottom: 20px;
}
.node {
    padding: 16px 16px 0;
    color: var(--secondary-text-color);
}
.vagganode{
    padding: 24px 16px 16px;
    color: var(--secondary-text-color);
}
.vagganode.firstvagga, .node+.vagganode {
  padding-top: 0;
}
@media screen and (min-width: 769px) {
    #drawertoggle {
        display:none;
    }
}
</style>
<template>
<iron-ajax
      auto
      url="[[_computeURL(category)]]"
      handle-as="json"
      last-response="{{suttaList}}"></iron-ajax>

<paper-scroll-header-panel main>

<paper-toolbar>
      <paper-icon-button id="drawertoggle" icon="menu" on-tap="toggleDrawer"></paper-icon-button>
      <span class="title"><p class="sutta">{{languageData.name}}â€”{{suttaList.namepi}}</p></span>
      <sc-toolbar></sc-toolbar>
</paper-toolbar>

<div class="divisioncontent">
  <main>
    <section class="node">
        <sc-node input-title="{{languageData.name}}" input-text="{{languageData.description}}" style-header="node-top-heading"></sc-node>
    </section>

    <template is="dom-repeat" items="{{suttaList.vaggas}}" as="vagga">
      <template is="dom-if" if="{{_selectVagga(vagga,vaggaNumber)}}">
            <section class$="vagganode {{_checkFirstVagga(vagga,vaggaNumber)}}">
              <sc-node input-title="{{_computeVagganame(vagga,inputLanguage)}}" input-text="{{_computeVaggadescription(vagga,inputLanguage)}}" style-header="node-secondary-heading"></sc-node>
            </section>

            <template is="dom-repeat" items="{{vagga.suttas}}" as="item">
              <div class="suttalist" id$="{{item}}">
                <sc-suttaplex input-url="{{item}}" input-language="{{inputLanguage}}"></sc-suttaplex>
              </div>
            </template>
        </template>
    </template>

  </main>
</div>

</paper-scroll-header-panel>
</template>
<script>
    Polymer({
      is: 'sc-view-suttaplex',
      properties: {
        inputLanguage: String,
        suttaList: Object,
        languageData: {
          type: Object,
          computed: '_computeLanguage(suttaList,inputLanguage)'
        },
        vaggaNumber: {
          type: String,
          value: ""
        }
      },
      ready: function() {
        this.addEventListener('toggleParallelNote', this.elevateBox);
      },
      elevateBox: function(event) {
        var sutta = document.getElementById(event.detail.url);
        return (event.detail.open === "icons:expand-more") ? sutta.classList.add('expandeditem') : sutta.classList.remove('expandeditem');
      },
      _computeURL: function(category) {
        return `../../data/list/${category}.json`;
      },
      _selectVagga: function(vagga,vaggaNumber) {
        return (vaggaNumber == undefined || vaggaNumber == "" || vaggaNumber == vagga.vagganr) ? true : false;
      },
      _checkFirstVagga: function(vagga,vaggaNumber) {
        return vaggaNumber ? ((vaggaNumber == vagga.vagganr) ? "firstvagga" : "") : "";
      },
      _computeLanguage: function(suttaList,inputLanguage) {
        return suttaList ? suttaList[inputLanguage] : "";
      },
      _computeVagganame: function(vagga,inputLanguage) {
        return vagga[inputLanguage].vagganame;
      },
      _computeVaggadescription: function(vagga,inputLanguage) {
        return vagga[inputLanguage].description;
      },
      toggleDrawer: function() {
        this.fire('eventFromChild',{togdraw:"drawer"});
      }
    });

</script>
</dom-module>

