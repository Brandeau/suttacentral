<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-collapse/iron-collapse.html">

<dom-module id="paper-tree-node">
<template>
<style>
:host(.selected) > .node-container > .node-row {
    background: linear-gradient(to right, rgba(223, 153, 10, 1) 4px, rgba(223, 153, 10, 0) 4px);
}
:host(.selected) > .node-container > .node-row > #actions {
    display: inline-block;
}
:host(.selected) > .node-container > .node-row a{
     color: var(--sc-gold-500);
}
.node-row {
    width: 100%;
    white-space: nowrap;
    @apply(--paper-font-body2);
    position: relative;
    text-transform: uppercase;
    letter-spacing: 0.04em;
}
.node-row a{
    text-transform: none;
    letter-spacing: 0em;
     text-decoration: none;
    color: var(--paper-green-500);
    cursor: pointer;
}
iron-icon {
    color: var(--disabled-text-color);
    float: right;
    padding: 6px 8px 0 0;
    cursor: pointer;
}
.data-lang {
    padding-left: 12px;
    color: var(--secondary-text-color);
    font-size: 12px;
    font-weight: normal;
}
.data-name {
    padding: 4px 0px 4px 16px;
    margin: 4px 0;
    display: inline-block;
    width: 70%;
}
.indent {
    padding-left: 32px;
}
ul {
    margin: 0;
    padding-left: 0px;
}
li {
    list-style-type: none;
}
    </style>


        <div class="node-container">
            <div class="node-row">
                <iron-icon icon="{{_computeIcon(data.*)}}" on-tap="toggleChildren"></iron-icon>
                <template is="dom-if" if="{{data.uid}}">
                    <a href$="/{{data.uid}}"><span class="node-name" on-tap="select"><span class$="data-name {{_computeIndent(data)}}">{{data.name}}<span class="data-lang">{{data.lang}}</span></span></span></a>
                </template>
                <template is="dom-if" if="{{!data.uid}}">
                    <span class="node-name" on-tap="select"><span class="data-name" inner-h-t-m-l="{{data.name}}"><span class="data-lang">{{data.lang}}</span></span></span>
                </template>

            </div>
            <iron-collapse id="collapse" opened="{{opened}}">
            <ul class$={{!data.open}}>
                <template is="dom-repeat" items="{{data.children}}">
                    <li>
                        <paper-tree-node id="{{item.uid}}" data="{{item}}" actions="{{actions}}"></paper-tree-node>
                    </li>
                </template>
            </ul>
            </iron-collapse>
        </div>
    </template>

</dom-module>

<script>

    Polymer({

        is: 'paper-tree-node',

        properties: {

            /**
             * Data hold by this node (contains the children).
             *
             * Specific data:
             *
             * - `data.name`: string representing the node name.
             * - `data.icon`: string telling which icon to use (default to 'folder' icon).
             * - `data.open`: boolean telling whether the node is expanded or not.
             * - `data.children` array containing the children of the node.
             */
            data: {
                type: Object,
                value: function() {
                    return null;
                }
            },
        },

        /**
         * The `select` event is fired whenever `select()` is called on the node.
         *
         * @event select
         */

        /**
         * Returns the necessary classes.
         *
         * @param {object} change An object containing the property that changed and its value.
         * @return {string} The class name indicating whether the node is open or closed
         */
        _computeIcon: function(change) {
            var open = change && change.base && change.base.open;
            var children = change && change.base && change.base.children;
            return ((open && children && children.length) ? 'expand-less' : children && children.length ? 'expand-more' : '');
        },
        _computeIndent: function(data) {
            return (data.children || data.lang) ? "" : "indent";
        },
        /**
         * Highlights node as the selected node.
         */
        select: function() {
            this.fire("select", this);
        },

        /**
         * Returns the parent node. Returns `null` if root.
         */
        getParent: function () {
            return this.domHost.tagName === 'PAPER-TREE-NODE' ? this.domHost : null;
        },

        /**
         * Returns the children tree nodes.
         */
        getChildren: function () {
            return Polymer.dom(this.root).querySelectorAll('paper-tree-node');
        },

        /**
         * Display/Hide the children nodes.
         */
        toggleChildren: function(e) {
            this.opened = !this.opened;
            this.fire('toggle', this);
            this.set("data.open", !this.data.open && this.data.children && this.data.children.length);
        }

    });

</script>
