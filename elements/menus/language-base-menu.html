<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu-light.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../styles/language-styles.html">

<dom-module id="language-base-menu" attributes="Language">
<style is="custom-style" include="language-styles">
:host {
  --primary-color: var(--sc-gold-500);
}
paper-dropdown-menu, paper-listbox {
    width: 200px;
}

paper-item {
    @apply(--sc-sans-font);
    text-transform: capitalize;
}

</style>
<template>
    <iron-ajax
          auto
          url="../../data/languages.json"
          handle-as="json"
          last-response="{{languageChoice}}"></iron-ajax>

	<paper-dropdown-menu class="custom" label="Language" title="Select the site in another language">
	  <paper-listbox class="dropdown-content" selected="{{languageSelectedNr}}">
	  <template is="dom-repeat" items="{{languageChoice}}" as="language">
	    	  <paper-item class$="{{language.id}}">{{language.full}}</paper-item>
	    </template>
	  </paper-listbox>
	</paper-dropdown-menu-light>
</template>

<script>
    Polymer({
        is: 'language-base-menu',

        properties: {
          languageChoice: Array,
          languageSelectedNr: {
                    type: Number,
                    value: 0
          },
          selectedLanguage: {
            type: String,
            computed: '_computeNewLanguage(languageSelectedNr,languageChoice)',
            observer: '_passNewLanguageSelected'
          },
          inputLanguage: {
            type: String,
            notify: true
          }
    	},
      observers: [
            '_checkLanguageNr(languageSelectedNr,languageChoice)'
      ],

      ready: function() {
        console.log(this.inputLanguage, this.selectedLanguage);
        if (this.inputLanguage !== this.selectedLanguage) {
          this.selectedLanguage = this.inputLanguage;
        }
      },
      _checkLanguageNr: function(languageSelectedNr,languageChoice) {
        if (this.inputLanguage && languageChoice) {
          console.log("array= ", languageChoice);
            if (languageChoice[languageSelectedNr].id !== this.inputLanguage) {
              for (var i=0 ; i<languageChoice.length ; i++) {
                if (languageChoice[i].id === this.inputLanguage) {
                  this.languageSelectedNr = i;
                }
              }
            }
          }
      },
        _passNewLanguageSelected: function(selectedLanguage) {
          console.log(selectedLanguage);
          this.fire('languageSelection',{Language:selectedLanguage});
        },
        _computeNewLanguage: function(languageSelectedNr,languageChoice) {
           return languageChoice ? languageChoice[languageSelectedNr].id : "en";
        }
    });

</script>
</dom-module>
