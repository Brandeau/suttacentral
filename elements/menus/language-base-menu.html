<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../styles/language-styles.html">
<link rel="import" href="../../bower_components/neon-animation/web-animations.html">

<dom-module id="language-base-menu" attributes="Language">
<template>
<style is="custom-style" include="language-styles">
:host {
  --primary-color: var(--sc-gold-500);
}
paper-dropdown-menu, paper-listbox {
    width: 200px;
}

paper-item {
    @apply(--sc-sans-font);
    text-transform: capitalize;
}

</style>
    <iron-ajax
          auto
          url="../../data/languages.json"
          handle-as="json"
          last-response="{{languageChoice}}"
          on-response="_didRespond"></iron-ajax>

	<paper-dropdown-menu class="custom" label="Language" title="Select the site in another language">
	  <paper-listbox slot="dropdown-content" selected="{{languageSelectedNr}}">
	  <template is="dom-repeat" items="{{languageChoice}}" as="language">
	    	  <paper-item id$="{{language.id}}">{{language.full}}</paper-item>
	    </template>
	  </paper-listbox>
	</paper-dropdown-menu>
</template>

<script>
    Polymer({
        is: 'language-base-menu',

        properties: {
          languageChoice: {
            type: Array,
            notify: true,
            value: function(){return []}
          },
          languageSelectedNr: Number,
          selectedLanguage: {
            type: String,
            // computed: '_computeNewLanguage(languageSelectedNr,languageChoice)',
            observer: '_passNewLanguageSelected'
          },
          inputLanguage: {
            type: String,
            notify: true
          }
    	},
      observers: [
            '_checkLanguageNr(inputLanguage,languageChoice)'
      ],

      ready: function() {
        if (this.inputLanguage === undefined) {return this.languageSelectedNr = 0;}
      },
      _didRespond: function(e) {
        this._computeNewLanguage(this.languageSelectedNr,e.detail.response);
      },
      _checkLanguageNr: function(inputLanguage,languageChoice) {
          if (inputLanguage === undefined) {return this.languageSelectedNr = 0;}
          else {
            for (var i = 0 ; i < languageChoice.length ; i++) {
              if (languageChoice[i].id === inputLanguage) {
                return this.languageSelectedNr = i;
              }
            }
          }
      },
        _passNewLanguageSelected: function(selectedLanguage) {
          this.fire('languageSelection',{Language:selectedLanguage});
          this.inputLanguage = this.selectedLanguage;
        },
        _computeNewLanguage: function(languageSelectedNr,languageChoice) {
          if (languageChoice) {
            this.selectedLanguage = languageChoice[languageSelectedNr].id;
            } else {
            this.selectedLanguage = "en";
          }
        }
    });

</script>
</dom-module>
