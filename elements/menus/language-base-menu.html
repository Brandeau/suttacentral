<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../styles/language-styles.html">
<link rel="import" href="../../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../../bower_components/app-storage/app-localstorage/app-localstorage-document.html">

<dom-module id="language-base-menu" attributes="Language">
<template>
<style is="custom-style" include="language-styles">
:host {
  --primary-color: var(--sc-gold-500);
}
paper-dropdown-menu, paper-listbox {
    width: 200px;
}

paper-item {
    @apply --sc-sans-font;
    text-transform: capitalize;
}

</style>
    <iron-ajax
          auto
          url="../../data/languages.json"
          handle-as="json"
          last-response="{{languageChoice}}"
          on-response="_didRespond"></iron-ajax>

	<paper-dropdown-menu class="custom" label="Language" title="Select the site in another language">
	  <paper-listbox slot="dropdown-content" selected="{{languageSelectedNr}}">
	  <template is="dom-repeat" items="[[languageChoice]]" as="language">
	    	  <paper-item id$="[[language.id]]">[[language.full]]</paper-item>
	    </template>
	  </paper-listbox>
           <app-localstorage-document key="languageSelectedNr" data="{{languageSelectedNr}}"></app-localstorage-document>
	</paper-dropdown-menu>


</template>

<script>
    Polymer({
        is: 'language-base-menu',

        properties: {
          languageChoice: {
            type: Array,
            notify: true,
            value: function(){return []}
          },
          languageSelectedNr: {
            type: Number,
            value: 0,
            notify: true
          }
    	},
      observers: [
          '_computeNewLanguage(languageSelectedNr,languageChoice)'
      ],
      _didRespond: function(e) {
        this._computeNewLanguage(this.languageSelectedNr,e.detail.response);
      },
        _passNewLanguageSelected: function(selectedLanguage) {
          this.fire('languageSelection',{Language:selectedLanguage});
        },
        _computeNewLanguage: function(languageSelectedNr,languageChoice) {
          if (languageChoice[languageSelectedNr]) {
            this._passNewLanguageSelected(languageChoice[languageSelectedNr].id);
            } else {
            this._passNewLanguageSelected("en");
          }
        }
    });

</script>
</dom-module>
