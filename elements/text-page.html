<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/paper-styles/paper-styles.html">
<link rel="import" href="sc-toolbar.html">

<dom-module id="text-page">
<style is="custom-style">
paper-scroll-header-panel {
  height: 100%;
}

.textpage {
  height: 4em;
  background-color: var(--sc-gold-500);
  @apply(--shadow-elevation-8dp);
}

.textcontent {
  color: var(--primary-text-color);
  padding: 24px 0;
}
</style>
<template>

<iron-ajax
      auto
      url="[[_computeURL(suttaPath)]]"
      handle-as="text"
      last-response="{{suttaText}}"></iron-ajax>

<iron-ajax
      auto
      url="../data/paragraphtitles.json"
      handle-as="json"
      last-response="{{paragraphTitles}}"></iron-ajax>

<paper-scroll-header-panel>
  <div class="paper-header textpage">
    <sc-toolbar
        toolbar-color="var(--sc-gold-500)"
        toolbar-size=""
        top-title="[[_computeTitle(suttaText)]]â€”[[_computeAuthor(suttaText)]]"
        setting-button="true"
        data-page='text'
        meta-area="[[_computeMeta(suttaText,paragraphTitles)]]">
    </sc-toolbar>
  </div>

<div class="textcontent">
  <div inner-h-t-m-l="{{suttaText}}"></div>
</div>

</paper-scroll-header-panel>
</template>
<script>
    Polymer({
      is: 'text-page',

      properties: {
        suttaPath: String,
        suttaText: {
          type: String,
          observer: '_obsInputText'
        }
      },

      _computeURL: function(category) {
        return `../texts${category}.html`;
      },

      _obsInputText: function(suttaText) {
        var sutta = this.querySelectorAll('h1');
        console.log(sutta);
      },

      _computeTitle: function(suttaText) {
        var title = this.querySelectorAll('.division');
        var firstTitle = Array.from(title)[0];
        if (firstTitle !== undefined) {
          return firstTitle.innerText;
        }
      },
      _computeAuthor: function(suttaText) {
        var author = this.querySelectorAll('.author');
        var firstAuthor = Array.from(author)[0];
        if (firstAuthor !== undefined) {
          return firstAuthor.innerText;
        }
      },
      _computeMeta: function(suttaText,paragraphTitles) {
        var meta = this.querySelectorAll('#metaarea');
        var firstMeta = Array.from(meta)[0];
        for (var key in paragraphTitles) {
                var refs = this.querySelectorAll('.'+key);
                Array.from(refs).forEach(item => item.innerHTML = item.id.replace(/[a-z\-]*/g,""));
        };
        if (firstMeta !== undefined) {
          return firstMeta.innerHTML;
        }
      }

    });

</script>
</dom-module>
