<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="sc-page-static.html">
<link rel="import" href="sc-view-suttaplex.html">
<link rel="import" href="sc-page-text.html">
<link rel="import" href="sc-segmented-text.html">
<link rel="import" href="sc-toolbar.html">

<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
 <link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">

<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="menus/settings-menu.html">

<dom-module id="page-selector">
<template>
<style is="custom-style">
:host {
  display: block;
  box-sizing: border-box;
}
   
.container {
  position: relative;
}

app-header {
  z-index: 1000;
  @apply(--shadow-elevation-8dp);
}
app-toolbar:nth-of-type(2), app-toolbar:nth-of-type(3){
  z-index: -1;
}

app-toolbar {
   background-color: var(--sc-gold-500);
}

h1{
  @apply(--sc-serif-font);
  @apply(--sc-mixed-small-caps);
  font-size: 2.5em;
  text-align: left;
  color: white;
  padding-top: 0.5em;
  margin: 0;
  line-height: 1em;
  font-weight: normal;
}

.subtitle {
  @apply(--sc-sans-font);
  color: white;
  font-style: italic;
  font-size: 1.5em;
  text-align: left;
  margin-bottom: .75em;
  margin-top: 0;
}

.title {
  margin-left: 64px;
}

@media (max-width: 925px) {
    .subtitle {
      font-size: 1.2em;
      margin-bottom: 0.5em;
    };
}
@media (max-width: 800px) {
    .title {
      margin-left: initial;
    };
}
@media (max-width: 600px) {
    h1 {
      font-size: 2em;
      padding-top: 0.2em;
    };
    .subtitle {
      font-size: 1em;
      margin-bottom: 0.5em;
    };
}

.darktoolbar {
  background-color: var(--paper-deep-orange-900);
}

#settingsbutton {
  color: white;
}

paper-dialog {
  top: 50px;
  max-width: 600px;
}
paper-dialog-scrollable {
  padding-bottom:20px;
}
paper-dialog paper-icon-button {
  color: var(--disabled-text-color);
}
h2{
  @apply(--paper-font-headline);
  @apply(--sc-sans-font);
  margin: 0;
}
#toolbartitle {
  text-transform: capitalize;
  @apply(--sc-sans-font);
  color: white;
  z-index:-10;
}

@media screen and (max-width: 640px) {
    #toolbartitle {
      margin-left:50px;
    }
}
@media screen and (max-width: 450px) {
    #toolbartitle {
      font-size:16px;
    }
}
</style>
<app-route route="{{route}}"
      pattern="/"
      active="{{staticActive}}"></app-route>

<app-route route="{{route}}"
      pattern="/list"
      active="{{listActive}}"></app-route>

    <div class="container">
      <app-header-layout>
        <app-header id="header" condenses reveals effects="waterfall" slot="header">
                <app-toolbar id="toolbarheader">
                  <div main-title id="toolbartitle">{{toolbarTitle}}</div>
                  <sc-toolbar  input-language="{{inputLanguage}}"></sc-toolbar>
                   <paper-icon-button id="settingsbutton" icon="settings" onclick="dialog.open()"></paper-icon-button>
                </app-toolbar>
          
            <app-toolbar class="statictoolbar">
                  <div class="title" main-title><h1>SuttaCentral</h1></div>
            </app-toolbar>
            <app-toolbar class="statictoolbar">
                  <div class="title" main-title><p class="subtitle">Early Buddhist texts, translations, and parallels</p></div>
            </app-toolbar>
        </app-header>

        <paper-dialog id="dialog">
          <div class="buttons">
            <paper-icon-button icon="close" dialog-confirm autofocus></paper-icon-button>
          </div>
          <h2>Tools and Information</h2>
          <paper-dialog-scrollable>
              <settings-menu meta-area="{{metaArea}}" disable-views="{{viewsDisabled}}"></settings-menu>
          </paper-dialog-scrollable>
        </paper-dialog>

        <iron-pages id="pages" role="main" selected="{{pages}}" attr-for-selected="name">
          <div name="static">
                <sc-page-static category="{{category}}" active="{{staticActive}}" input-language="{{inputLanguage}}"></sc-page-static>
          </div>
          <div name="list">
                <sc-view-suttaplex category="{{category}}" vagga-number="{{_getVaggaNumber(route)}}" active="{{listActive}}" input-language="{{inputLanguage}}"></sc-view-suttaplex>
          </div>
          <div name="text">
              <sc-page-text sutta-path="{{route.prefix}}" active="{{suttaActive}}" input-language="{{inputLanguage}}"></sc-page-text>
          </div>
          <div name="segmented">
              <sc-segmented-text sutta-path="{{route.prefix}}" active="{{suttaActive}}" show-viewer="{{showViewer}}"></sc-segmented-text>
        </iron-pages>

      </app-header-layout>
    </div>
</template>
<script>
    Polymer({
      is: 'page-selector',
      properties: {
        inputLanguage: String,
        toolbarTitle: {
          type: String,
          value: ""
        },
        viewsDisabled: {
          type: Boolean,
          value: false
        },
        metaArea: {
          type: String,
          value: ""
        },
        route: {
          type: String,
          observer: '_changeView'
        },
        pages: {
          type: String,
          value: 'static'
        },
        showViewer: String
      },
      ready: function() {
        this.addEventListener('eventFromTextPage', this.addTextTitles);
        this.addEventListener('eventFromSuttaplexPage', this.addSuttaplexTitles);
        this.addEventListener('eventFromSegmentedTextPage', this.addSegmentedTextTitles);
        this.addEventListener('eventFromTools', this.changeSegmentedView);
      },
      addTextTitles: function(event) {
        if (this.$.pages.selected === "text") {
          this.toolbarTitle = event.detail.suttatitle;
          this.metaArea = event.detail.suttameta;
          // this.viewsDisabled = true;
        }
      },
      addSuttaplexTitles: function(event) {
        if (this.$.pages.selected === "list") {
          this.toolbarTitle = event.detail.divisiontitle;
        }
      },
      addSegmentedTextTitles: function(event) {
        if (this.$.pages.selected === "segmented") {
          this.toolbarTitle = event.detail.suttasegtitle;
          this.metaArea = event.detail.suttasegmeta;
          this.viewsDisabled = false;
        }
      },
      changeSegmentedView: function(event) {
          return this.showViewer = event.detail.selectedView;
      },
      _changeView: function(route) {
        this.$.header.resetLayout();
        this.toolbarTitle = '';
        this.viewsDisabled = false;
        var toolbarheader = this.$.toolbarheader;
        var settings = this.$.settingsbutton;
        toolbarheader.classList.remove('darktoolbar');
        Array.from(this.querySelectorAll(".statictoolbar")).forEach(item => item.setAttribute('style', "display:none;"));
        settings.setAttribute('style', "display:none;");
        if (route.path === "") {
          this.$.pages.selected = "static";
          Array.from(this.querySelectorAll(".statictoolbar")).forEach(item => item.removeAttribute('style', "display:none;"));
        } else if (route.path.endsWith("/list")) {
          this.$.pages.selected = "list";
          toolbarheader.classList.add('darktoolbar');
        } else if (route.path === "/sujato") {
          settings.removeAttribute('style', "display:none;");
          this.$.pages.selected = "segmented";
        } else {
          settings.removeAttribute('style', "display:none;");
          this.$.pages.selected = "text";
        }
      },
      _getVaggaNumber: function(route) {
        if (route.path !== "/list" && route.path.endsWith("/list")) {
            var vnr = route.path.replace("/list","");
            return vnr.replace("/","");
          } else {
            return "";
          }
      }
    });
</script>
</dom-module>