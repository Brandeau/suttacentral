<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="sc-page-static.html">
<link rel="import" href="sc-view-suttaplex.html">
<link rel="import" href="sc-page-text.html">
<link rel="import" href="sc-segmented-text.html">
<link rel="import" href="sc-toolbar.html">

<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">

<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">

<dom-module id="page-selector" attributes="togdraw">
<template>
<style is="custom-style">
:host {
  display: block;
  box-sizing: border-box;
}
   
.container {
  position: relative;
}

app-header {
  z-index: 1000;
  @apply(--shadow-elevation-8dp);
}
app-toolbar:nth-of-type(2), app-toolbar:nth-of-type(3){
  z-index: -1;
}

app-toolbar, sc-toolbar {
   background-color: var(--sc-gold-500);
   white-space: nowrap;
}

h1{
  @apply(--sc-serif-font);
  @apply(--sc-mixed-small-caps);
  font-size: 2.5em;
  text-align: left;
  color: white;
  padding-top: 0.5em;
  margin: 0;
  line-height: 1em;
  font-weight: normal;
}

.subtitle {
  @apply(--sc-sans-font);
  color: white;
  font-style: italic;
  font-size: 1.5em;
  text-align: left;
  margin-bottom: .75em;
  margin-top: 0;
}

.title {
  margin-left: 64px;
}

@media (max-width: 925px) {
    .subtitle {
      font-size: 1.2em;
      margin-bottom: 0.5em;
    };
}
@media (max-width: 800px) {
    .title {
      margin-left: initial;
    };
}
@media (max-width: 600px) {
    h1 {
      font-size: 2em;
      padding-top: 0.2em;
    };
    .subtitle {
      font-size: 1em;
      margin-bottom: 0.5em;
    };
}

.list-mode #sctoolbar, .list-mode #toolbarheader {
  background-color: var(--paper-deep-orange-900);
}

#toolbartitlebox {
  width: 1px;
  z-index:-10;
}
#toolbartitle {
  text-transform: capitalize;
  @apply(--sc-sans-font);
  color: white;
}

@media screen and (max-width: 450px) {
    #toolbartitle {
      font-size:16px;
    }
}
#drawertoggle {
  z-index: 1;
  color: white;
}
@media screen and (min-width: 841px) {
    #drawertoggle {
      display: none;
    }
}
</style>
    <div class="container">
      <app-header-layout id="appheaderstuff">
        <app-header id="header" condenses reveals effects="waterfall" slot="header" class$="{{mainClass}}">
                <app-toolbar id="toolbarheader">
                  <paper-icon-button icon="menu" id="drawertoggle" on-tap="_toggleDrawer"></paper-icon-button>
                  <div main-title id="toolbartitlebox"><p id="toolbartitle">{{toolbarTitle}}</p></div>
                  <sc-toolbar id="sctoolbar" input-language="{{inputLanguage}}" sutta-path="{{suttaPath}}" meta-area="{{metaArea}}"></sc-toolbar>
                </app-toolbar>

          <template is="dom-if" if="{{_checkStatic(category)}}">
            <app-toolbar class="statictoolbar">
                  <div class="title" main-title><h1>SuttaCentral</h1></div>
            </app-toolbar>
            <app-toolbar class="statictoolbar">
                  <div class="title" main-title><p class="subtitle">Early Buddhist texts, translations, and parallels</p></div>
            </app-toolbar>
            </template>
        </app-header>

            <template is="dom-if" if="{{_checkStatic(category)}}">
                <sc-page-static category="{{category}}" input-language="{{inputLanguage}}"></sc-page-static>
            </template>

            <template is="dom-if" if="{{_checkList(category,suttaPath)}}">
                <sc-view-suttaplex category="{{category}}" vagga-number$="{{_computeVagga(queryParams)}}" input-language="{{inputLanguage}}"></sc-view-suttaplex>
            </template>

            <template is="dom-if" if="{{_checkText(category,suttaPath,author)}}">
              <sc-page-text sutta-path="{{category}}" author="{{author}}" input-language="{{inputLanguage}}"></sc-page-text>
            </template>

            <template is="dom-if" if="{{_checkSegmented(category,suttaPath,author)}}">
              <sc-segmented-text sutta-path="{{category}}" author="{{author}}" show-viewer="{{showViewer}}" input-language="{{inputLanguage}}"></sc-segmented-text>
            </template>

      </app-header-layout>
    </div>
</template>
<script>
    Polymer({
      is: 'page-selector',
      properties: {
        inputLanguage: String,
        toolbarTitle: {
          type: String,
          value: ""
        },
        metaArea: {
          type: String,
          value: ""
        },
        showViewer: String,
        suttaPath: {
          type: Boolean,
          notify: true
        },
        author: {
          type: String,
          notify: true
        },
        category: {
          type: String,
          notify: true,
          observer: '_changeView'
        },
        queryParams: {
          type: Object,
          notify: true
        },
        mainClass: String,
        staticPages: {
          type: Array,
          value: ["home","dons","people","downloads",""]
        }
      },
      observers: [
        '_changeView(category,author,suttaPath)'
      ],
      ready: function() {
        this.addEventListener('eventFromTextPage', this.addTextTitles);
        this.addEventListener('eventFromSuttaplexPage', this.addSuttaplexTitles);
        this.addEventListener('eventFromSegmentedTextPage', this.addSegmentedTextTitles);
        this.addEventListener('eventFromTools', this.changeSegmentedView);
      },
      addTextTitles: function(event) {
        if (this.suttaPath && this.author !== "sujato" && (this.staticPages.indexOf(this.category) == -1)) {
          this.toolbarTitle = event.detail.suttatitle;
          this.metaArea = event.detail.suttameta;
        }
      },
      addSuttaplexTitles: function(event) {
        if (!this.suttaPath && (this.staticPages.indexOf(this.category) == -1)) {
          this.toolbarTitle = event.detail.divisiontitle;
        }
      },
      addSegmentedTextTitles: function(event) {
        if (this.suttaPath && this.author === "sujato" && (this.staticPages.indexOf(this.category) == -1)) {
          this.toolbarTitle = event.detail.suttasegtitle;
          this.metaArea = event.detail.suttasegmeta;
        }
      },
      _computeVagga: function(queryParams) {
        return (queryParams.vagga) ? queryParams.vagga : "";
      },
      changeSegmentedView: function(event) {
          return this.showViewer = event.detail.selectedView;
      },
      _changeView: function(category,author,suttaPath) {
        // Reset all toolbar display settings with regards to the search input field
        document.getElementById('searchinput').classList.remove('opened');
        document.getElementById('searchinput').removeAttribute('style', "width");
        document.getElementById('closebutton').style.display='none';
        document.getElementById('toolbartitlebox').removeAttribute('style', "visibility");
        document.getElementById('discoursebutton').removeAttribute('style', "display");
        document.getElementById('morevertbutton').removeAttribute('style', "display");
        document.getElementById('discoursedropdown').removeAttribute('style', "display");
        this.$.header.resetLayout();
      },

      _toggleDrawer: function() {
                this.fire('toggleDrawer',{togdraw:"opened"});
      },
      _checkStatic: function(category) {
        if (this.staticPages.indexOf(category) > -1){
          this.mainClass="static-mode";
          this.toolbarTitle = ''
          return true;S
        } else {
        return false;
        }
      },
      _checkList: function(category,suttaPath) {
        if (!suttaPath && (this.staticPages.indexOf(category) == -1)) {
          this.mainClass="list-mode";
          return true;
        } else {
          return false;
        }
      },
      _checkText: function(category,suttaPath,author) {
        if (suttaPath && author !== "sujato" && (this.staticPages.indexOf(category) == -1)) {
            this.mainClass="text-mode";
            return true;
        } else {        
            return false;
        }
      },
      _checkSegmented: function(category,suttaPath,author) {
        if (suttaPath && author === "sujato" && (this.staticPages.indexOf(category) == -1)) {
            this.mainClass="segmented-mode";
            return true;
        } else {        
            return false;
        }
      }
    });
</script>
</dom-module>