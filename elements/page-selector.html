<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="sc-page-static.html">
<link rel="import" href="sc-view-suttaplex.html">
<link rel="import" href="sc-page-text.html">
<link rel="import" href="sc-segmented-text.html">
<link rel="import" href="sc-toolbar.html">
<link rel="import" href="sc-page-search.html">

<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">

<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">

<dom-module id="page-selector" attributes="togdraw">
<template>
<style is="custom-style">
:host {
  display: block;
  box-sizing: border-box;
}
   
.container {
  position: relative;
}

app-toolbar, sc-toolbar {
   background-color: var(--sc-gold-500);
   white-space: nowrap;
}

.list-mode #toolbarheader, .text-mode #toolbarheader, .segmented-mode #toolbarheader {
    @apply(--shadow-elevation-8dp);
}

.list-mode #sctoolbar, .list-mode #toolbarheader {
  background-color: var(--paper-deep-orange-900);
}

.search-mode #sctoolbar, .search-mode #toolbarheader {
  background-color: var(--sc-green-600);
}

#toolbartitlebox {
  width: 1px;
  z-index:-10;
}
#toolbartitle {
  text-transform: capitalize;
  @apply(--sc-sans-font);
  color: white;
}

@media screen and (max-width: 450px) {
    #toolbartitle {
      font-size:16px;
    }
}
#drawertoggle {
  z-index: 1;
  color: white;
}
@media screen and (min-width: 841px) {
    #drawertoggle {
      display: none;
    }
}
</style>
    <div class="container">
      <app-header-layout>
        <app-header id="header" condenses reveals effects="waterfall" slot="header" class$="{{mainClass}}">
                <app-toolbar id="toolbarheader">
                  <paper-icon-button icon="menu" id="drawertoggle" on-tap="_toggleDrawer"></paper-icon-button>
                  <div main-title id="toolbartitlebox"><p id="toolbartitle">{{toolbarTitle}}</p></div>
                  <sc-toolbar id="sctoolbar" input-language="{{inputLanguage}}" sutta-path="{{author}}" category="[[category]]" meta-area="{{metaArea}}"></sc-toolbar>
                </app-toolbar>
        </app-header>

            <template is="dom-if" if="{{_checkStatic(category)}}">
                <sc-page-static category="[[category]]" input-language="{{inputLanguage}}"></sc-page-static>
            </template>

            <template is="dom-if" if="{{_checkList(category,author)}}">
                <sc-view-suttaplex category="[[category]]" vagga-number$="{{_computeVagga(queryParams)}}" input-language="{{inputLanguage}}"></sc-view-suttaplex>
            </template>

            <template is="dom-if" if="{{_checkText(category,author)}}">
              <sc-page-text sutta-path="[[category]]" author="{{author}}" input-language="{{inputLanguage}}"></sc-page-text>
            </template>

            <template is="dom-if" if="{{_checkSegmented(category,author)}}">
              <sc-segmented-text sutta-path="[[category]]" author="{{author}}" show-viewer="{{showViewer}}" input-language="{{inputLanguage}}"></sc-segmented-text>
            </template>

            <template is="dom-if" if="{{_checkSearch(category)}}">
              <sc-page-search search-query="{{searchQuery}}"></sc-page-search>
            </template>

      </app-header-layout>
    </div>
</template>
<script>
    Polymer({
      is: 'page-selector',
      properties: {
        inputLanguage: String,
        toolbarTitle: {
          type: String,
          value: ""
        },
        metaArea: {
          type: String,
          value: ""
        },
        showViewer: String,
        category: {
          type: String,
          notify: true,
          observer: '_changeView'
        },
        queryParams: {
          type: Object,
          notify: true
        },
        author: {
          type: String,
          notify: true,
          computed: '_checkAuthor(queryParams)'
        },
        mainClass: String,
        staticPages: {
          type: Array,
          value: ["dons","people","downloads",""]
        },
        searchQuery: {
          type: String,
          notify: true,
          computed: '_checkSearchQuery(queryParams)'
        }
      },
      observers: [
        '_changeView(category,author)'
      ],
      ready: function() {
        this.addEventListener('eventFromTextPage', this.addTextTitles);
        this.addEventListener('eventFromSuttaplexPage', this.addSuttaplexTitles);
        this.addEventListener('eventFromSegmentedTextPage', this.addSegmentedTextTitles);
        this.addEventListener('eventFromTools', this.changeSegmentedView);
      },
      addTextTitles: function(event) {
        if (this.author && this.author !== "sujato" && (this.staticPages.indexOf(this.category) == -1)) {
          this.toolbarTitle = event.detail.suttatitle;
          this.metaArea = event.detail.suttameta;
        }
      },
      addSuttaplexTitles: function(event) {
        if (!this.author && (this.staticPages.indexOf(this.category) == -1) && this.category !== 'search') {
          this.toolbarTitle = event.detail.divisiontitle;
        }
      },
      addSegmentedTextTitles: function(event) {
        if (this.author && this.author === "sujato" && (this.staticPages.indexOf(this.category) == -1)) {
          this.toolbarTitle = event.detail.suttasegtitle;
          this.metaArea = event.detail.suttasegmeta;
        }
      },
      _checkAuthor: function(queryParams) {
        return (queryParams.author) ? queryParams.author : "";
      },
      _computeVagga: function(queryParams) {
        return (queryParams.vagga) ? queryParams.vagga : "";
      },
      _checkSearchQuery: function(queryParams) {
        return (queryParams.query) ? queryParams.query : "";
      },
      changeSegmentedView: function(event) {
          return this.showViewer = event.detail.selectedView;
      },
      _changeView: function(category,author) {
        this.$.sctoolbar.closeSearch();
        this.$.header.resetLayout();
      },

      _toggleDrawer: function() {
                this.fire('toggleDrawer',{togdraw:"opened"});
      },
      _checkStatic: function(category) {
        if (this.staticPages.indexOf(category) > -1){
          this.mainClass="static-mode";
          this.toolbarTitle = ''
          return true;
        } else {
        return false;
        }
      },
      _checkList: function(category,author) {
        if (!author && (this.staticPages.indexOf(category) == -1) && category !== 'search') {
          this.mainClass="list-mode";
          return true;
        } else {
          return false;
        }
      },
      _checkText: function(category,author) {
        if (author && author !== "sujato" && (this.staticPages.indexOf(category) == -1)) {
            this.mainClass="text-mode";
            return true;
        } else {        
            return false;
        }
      },
      _checkSegmented: function(category,author) {
        if (author && author === "sujato" && (this.staticPages.indexOf(category) == -1)) {
            this.mainClass="segmented-mode";
            return true;
        } else {
            return false;
        }
      },
      _checkSearch: function(category) {
        if (category === "search"){
          this.mainClass="search-mode";
          this.toolbarTitle = 'SuttaCentral â€” search results'
          return true;
        } else {
        return false;
        }
      },
    });
</script>
</dom-module>