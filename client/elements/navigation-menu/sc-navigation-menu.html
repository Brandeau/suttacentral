<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">

<dom-module id="sc-navigation-menu">
  <template>
    <style>
      .sc-nav {
        @apply --sc-sans-font;
      }

      .paper-spinner {
        --paper-spinner-color: var(--sc-primary-color);
      }

      .icon-middle {
        position: absolute;
        margin: 0;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      .network-error-icon {
        width: var(--sc-size-xxl);
        height: var(--sc-size-xxl);
      }

      .sc-nav-back-button {
        background-color: var(--sc-disabled-text-color);
        display: flex;
        align-items: center;
        font-weight: 500;
        font-size: 18px;
        height: 45px;
        left: 0;
        margin: 0;
        padding: 10px 20px;
        right: 0;
        top: 0;
        z-index: 1;
      }

      .sc-swap-section {
        left: 0;
        opacity: 0;
        top: 0;
        width: 100%;
        transition: opacity 1s, transform .5s;
        -webkit-transition: opacity 1s, -webkit-transform .5s;
      }

      .sc-nav .sc-swap-section {
        transition-duration: .3s;
        -webkit-transition-duration: .3s;
      }

      .sc-swap-section.sc-up {
        transform: translateY(-100%);
        -webkit-transform: translateY(-100%);
        -ms-transform: translateY(-100%);
      }

      .sc-swap-section.sc-right {
        transform: translateX(100%);
        -webkit-transform: translateX(100%);
        -ms-transform: translateX(100%);
      }

      .sc-swap-section.sc-left {
        transform: translateX(-100%);
        -webkit-transform: translateX(-100%);
        -ms-transform: translateX(-100%);
      }

      .sc-swap-section.sc-active {
        opacity: 1;
        position: relative;
        -webkit-transform: translate(0, 0);
        -ms-transform: translate(0, 0);
        transform: translate(0, 0);
        width: auto;
      }

      .sc-nav-sub {
        z-index: 1;
      }

    </style>

    <iron-ajax
        auto
        url="[[_getMenuUrl()]]"
        handle-as="json"
        loading="{{loading}}"
        last-error="{{error}}"
        last-response="{{navList}}">
    </iron-ajax>

    <div id="container" class="nav-list-container">
      <template is="dom-if" if="[[_shouldShowLoadingIndicator(loading, error)]]">
        <div class="loading-indicator">
          <paper-spinner-lite class="paper-spinner icon-middle" active="[[loading]]"></paper-spinner-lite>
        </div>
      </template>

      <template is="dom-if" if="[[error]]">
        <iron-icon class="network-error-icon icon-middle" title="Network error" src="img/nonetwork.svg"></iron-icon>
      </template>

      <!-- The navigation menu: -->
      <nav class="sc-nav">
        <div data-swap-container>
          <a class="sc-nav-back-button sc-swap-section sc-up">
            <iron-icon icon="arrow-back"></iron-icon>
            <span class="sc-nav-back-title">Home</span>
          </a>
          <div id="sc-sub-navigation" class="sc-nav-sub sc-swap-section sc-right sc-active">
            <ul id="sub-nav">
              <li class="nav-section">
                <div class="nav-section-header">
                  <a href="/">Creative Vision</a>
                  <iron-icon icon="expand-more"></iron-icon>
                </div>
              </li>
              <li class="nav-section">
                <div class="nav-section-header">
                  <a href="/">Second sub thing</a>
                  <iron-icon icon="expand-more"></iron-icon>
                </div>
              </li>
            </ul>
          </div>
          <ul id="sc-main-navigation" class="sc-nav-list sc-swap-section sc-left sc-active">
            <li class="sc-nav-menu-item">
              <a class="sc-nav-menu-link" href="/">Home</a>
              <iron-icon icon="expand-more"></iron-icon>
            </li>
            <li class="sc-nav-menu-item">
              <a class="sc-nav-menu-link" href="/">Design</a>
              <iron-icon icon="arrow-forward"></iron-icon>
            </li>
          </ul>
        </div>
      </nav>

    </div>

  </template>

  <script>
      class SCNavigationMenu extends Polymer.Element {
          static get is() {
              return 'sc-navigation-menu';
          }

          static get properties() {
              return {
                  navList: {
                      type: Array,
                      observer: '_parseNavList'
                  }
              }
          }

          // Open the first two tiers of the sidebar menu and add icons
          _parseNavList() {
              this.navList[0].open = true;
              if (!this.navList[0].children) {
                  return;
              }
              this.navList[0].children.forEach((item) => {
                  item.open = true;
                  item.icon = 'trending-flat';
                  if (!item.children) {
                      return;
                  }
                  item.children.forEach((subItem) => {
                      subItem.icon = 'turned-in';
                  })
              });
          }

          _shouldShowLoadingIndicator(loading, error) {
              return !!(loading && !error);
          }

          _getMenuUrl() {
              return `${this._getApiUrl()}/menu`;
          }

          _getApiUrl() {
              let currentUrl = window.location;
              return `${currentUrl.protocol}//${currentUrl.host}/api`;
          }
      }

      customElements.define(SCNavigationMenu.is, SCNavigationMenu);
  </script>
</dom-module>