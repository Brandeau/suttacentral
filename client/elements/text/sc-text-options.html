<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="/bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/bower_components/iron-dropdown/iron-dropdown-scroll-manager.html">
<link rel="import" href="/bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="/bower_components/neon-animation/web-animations.html">
<link rel="import" href="/bower_components/neon-animation/animations/fade-in-animation.html">
<link rel="import" href="/bower_components/neon-animation/animations/fade-out-animation.html">

<link rel="import" href="/styles/sc-suttaplex-styles.html">
<link rel="import" href="/elements/menus/settings-menu.html">
<link rel="import" href="/elements/suttaplex/sc-suttaplex.html">

<!--
Pulls in one relevant suttaplex-card inside a collapse-item to display on top of each sutta text.
-->
<dom-module id="sc-text-options">
  <template>
    <style include="sc-suttaplex-styles">
      .container {
        margin: 0 auto;
        padding: 32px 5% 0 !important;
        max-width: 640px;
        display: flex;
        flex-direction: column;
      }

      .heading {
        display: flex;
        justify-content: flex-end;
      }

      .sutta-list {
        max-width: 720px;
        transition: margin-top 0.3s, margin-bottom 0.3s;
        margin: 0 auto 64px;
      }

      .dialog {
        white-space: initial;
        max-width: 630px;
        position: fixed;
        top: 50px;
        margin: 5% auto;
        left: var(--app-drawer-width);
        right: 0;
      }

      @media screen and (max-width: 840px) {
        .dialog {
          left: 0;
        }
      }

      .dialog paper-icon-button {
        color: var(--disabled-text-color);
      }

      .margin-vertical-md {
        margin-top: 8px;
        margin-bottom: 8px;
      }

    </style>

    <div class="container">
      <div class="heading" title="View Parallels &amp; References">
        <paper-icon-button icon="info" on-tap="_openInfoDialog"></paper-icon-button>
        <paper-icon-button icon="settings" on-tap="_openSettingsDialog"></paper-icon-button>
        <paper-icon-button icon="[[_toggleIcon]]" on-tap="_toggleOpened"></paper-icon-button>
      </div>

      <iron-collapse opened="{{opened}}">
        <div class="sutta-list">
          <sc-suttaplex item="[[suttaplexItem]]"></sc-suttaplex>
        </div>
      </iron-collapse>
    </div>

    <paper-dialog id="settings_dialog" class="dialog"
                  entry-animation="fade-in-animation"
                  exit-animation="fade-out-animation">
      <div class="buttons">
        <paper-icon-button icon="close" dialog-confirm></paper-icon-button>
      </div>
      <h2>Text settings</h2>
      <paper-dialog-scrollable>
        <settings-menu meta-area="[[metaArea]]"></settings-menu>
      </paper-dialog-scrollable>
    </paper-dialog>

    <paper-dialog id="info_dialog" class="dialog"
                  entry-animation="fade-in-animation"
                  exit-animation="fade-out-animation">
      <div class="buttons">
        <paper-icon-button icon="close" dialog-confirm></paper-icon-button>
      </div>
      <h2>Sutta information</h2>
      <paper-dialog-scrollable>
        <div class="dialogue-section">
          <h3>Publication details</h3>
          <div inner-h-t-m-l="[[metaArea]]">
            <section class="margin-vertical-md">This is an independent sūtra. In the Taishō canon, on which this edition
              is based, it is collected together with the Dīrghāgama. The text is from CBETA.
            </section>
            <section class="margin-vertical-md">
              Prepared for SuttaCentral by Bhikkhu Sujato.
            </section>
            <section class="margin-vertical-md">
              First Added: 2017-01-27
              <br>
              Last Modified: 2017-01-27
            </section>
          </div>
        </div>
      </paper-dialog-scrollable>
    </paper-dialog>

  </template>

  <script>
      class SCTextOptions extends Polymer.Element {
          static get is() {
              return 'sc-text-options';
          }

          static get properties() {
              return {
                  suttaplexItem: Object,
                  _toggleIcon: {
                      type: String,
                      computed: '_computeToggleIcon(opened)'
                  },
                  opened: {
                      type: Boolean,
                      reflectToAttribute: true
                  },
                  metaArea: {
                      type: String
                  }

              }
          }

          ready() {
              super.ready();
              this._addScrollLockListeners();
          }

          _addScrollLockListeners() {
              let scrollLockListener = (dialog) => {
                  if (dialog.opened) {
                      Polymer.IronDropdownScrollManager.pushScrollLock(dialog);
                  } else {
                      Polymer.IronDropdownScrollManager.removeScrollLock(dialog);
                  }
              };
              let settingsDialog = this.$.settings_dialog;
              let infoDialog = this.$.info_dialog;
              settingsDialog.addEventListener('opened-changed', () => { scrollLockListener(settingsDialog) });
              infoDialog.addEventListener('opened-changed', () => { scrollLockListener(infoDialog) });
          }

          _toggleOpened() {
              this.opened = !this.opened;
              this.dispatchEvent(new CustomEvent('toggle', { detail: this, bubbles: true, composed: true }));
          }

          _computeToggleIcon() {
              return this.opened ? 'icons:expand-less' : 'icons:expand-more';
          }

          _openSettingsDialog() {
              this.$.settings_dialog.open();
          }

          _openInfoDialog() {
              this.$.info_dialog.open();
          }
      }

      customElements.define(SCTextOptions.is, SCTextOptions);
  </script>

</dom-module>
